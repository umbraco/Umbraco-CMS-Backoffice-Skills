{"version":3,"file":"folder-workspace.context-C9fZTAR5.js","sources":["../../../Client/src/workspace/folder/folder-workspace-editor.element.ts","../../../Client/src/workspace/folder/folder-workspace.context.ts"],"sourcesContent":["/**\r\n * Folder Workspace Editor Element\r\n *\r\n * Displays the folder name in the header and a grid of child items.\r\n * Clicking a child folder navigates to that folder's workspace.\r\n * Clicking a child note opens the note workspace.\r\n *\r\n * Skills used: umbraco-workspace, umbraco-umbraco-element, umbraco-routing, umbraco-modals, umbraco-notifications\r\n */\r\n\r\nimport { html, css, customElement, state } from \"@umbraco-cms/backoffice/external/lit\";\r\nimport { UmbLitElement } from \"@umbraco-cms/backoffice/lit-element\";\r\nimport { UMB_WORKSPACE_CONTEXT } from \"@umbraco-cms/backoffice/workspace\";\r\nimport { UMB_MODAL_MANAGER_CONTEXT } from \"@umbraco-cms/backoffice/modal\";\r\nimport { UMB_NOTIFICATION_CONTEXT } from \"@umbraco-cms/backoffice/notification\";\r\nimport { UMB_ACTION_EVENT_CONTEXT } from \"@umbraco-cms/backoffice/action\";\r\nimport { UmbRequestReloadChildrenOfEntityEvent } from \"@umbraco-cms/backoffice/entity-action\";\r\nimport type { FolderWorkspaceContext } from \"./folder-workspace.context.js\";\r\nimport { NoteswikiService } from \"../../api/index.js\";\r\nimport type { TreeItemModel } from \"../../api/types.gen.js\";\r\nimport { UMB_EDIT_NOTE_WORKSPACE_PATH_PATTERN, UMB_EDIT_FOLDER_WORKSPACE_PATH_PATTERN, UMB_CREATE_NOTE_WORKSPACE_PATH_PATTERN } from \"../paths.js\";\r\nimport { FOLDER_NAME_MODAL } from \"../../entity-actions/rename-folder.modal-token.js\";\r\nimport { NOTES_FOLDER_ENTITY_TYPE } from \"../../constants.js\";\r\n\r\ninterface ChildItem {\r\n  unique: string;\r\n  name: string;\r\n  isFolder: boolean;\r\n  icon: string;\r\n}\r\n\r\n@customElement(\"folder-workspace-editor-element\")\r\nexport class FolderWorkspaceEditorElement extends UmbLitElement {\r\n  #workspaceContext?: FolderWorkspaceContext;\r\n\r\n  @state()\r\n  private _name = \"\";\r\n\r\n  @state()\r\n  private _children: ChildItem[] = [];\r\n\r\n  @state()\r\n  private _loading = true;\r\n\r\n  @state()\r\n  private _searchQuery = \"\";\r\n\r\n  @state()\r\n  private _createMenuOpen = false;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.consumeContext(UMB_WORKSPACE_CONTEXT, (context) => {\r\n      this.#workspaceContext = context as unknown as FolderWorkspaceContext;\r\n      this.#observeContext();\r\n    });\r\n  }\r\n\r\n  #observeContext() {\r\n    if (!this.#workspaceContext) return;\r\n\r\n    this.observe(this.#workspaceContext.name, (name) => {\r\n      this._name = name;\r\n    });\r\n\r\n    this.observe(this.#workspaceContext.unique, (unique) => {\r\n      if (unique) {\r\n        this.#loadChildren(unique);\r\n      }\r\n    });\r\n  }\r\n\r\n  async #loadChildren(parentUnique: string) {\r\n    this._loading = true;\r\n\r\n    try {\r\n      const response = await NoteswikiService.getChildren({\r\n        path: { parentId: parentUnique },\r\n      });\r\n\r\n      this._children = response.data.items.map((item: TreeItemModel) => ({\r\n        unique: item.id,\r\n        name: item.name,\r\n        isFolder: item.isFolder,\r\n        icon: item.isFolder ? \"icon-folder\" : \"icon-notepad\",\r\n      }));\r\n    } catch (error) {\r\n      console.error(\"Error loading children:\", error);\r\n      this._children = [];\r\n    } finally {\r\n      this._loading = false;\r\n    }\r\n  }\r\n\r\n  #getItemHref(item: ChildItem): string {\r\n    if (item.isFolder) {\r\n      return UMB_EDIT_FOLDER_WORKSPACE_PATH_PATTERN.generateAbsolute({\r\n        unique: item.unique,\r\n      });\r\n    }\r\n    return UMB_EDIT_NOTE_WORKSPACE_PATH_PATTERN.generateAbsolute({\r\n      unique: item.unique,\r\n    });\r\n  }\r\n\r\n  #handleSearchInput(e: InputEvent) {\r\n    const target = e.target as HTMLInputElement;\r\n    this._searchQuery = target.value;\r\n  }\r\n\r\n  #onPopoverToggle(event: ToggleEvent) {\r\n    this._createMenuOpen = (event as any).newState === \"open\";\r\n  }\r\n\r\n  #getCreateNoteHref(): string {\r\n    const folderUnique = this.#workspaceContext?.getUnique();\r\n    return UMB_CREATE_NOTE_WORKSPACE_PATH_PATTERN.generateAbsolute({\r\n      parentEntityType: NOTES_FOLDER_ENTITY_TYPE,\r\n      parentUnique: folderUnique ?? \"null\",\r\n    });\r\n  }\r\n\r\n  async #handleCreateFolder() {\r\n    const parentUnique = this.#workspaceContext?.getUnique() ?? null;\r\n\r\n    // Open create folder modal\r\n    const modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n    if (!modalManager) return;\r\n\r\n    const modal = modalManager.open(this, FOLDER_NAME_MODAL, {\r\n      data: {\r\n        headline: \"Create Folder\",\r\n        currentName: \"\",\r\n        confirmLabel: \"Create\",\r\n      },\r\n    });\r\n\r\n    const result = await modal.onSubmit().catch(() => undefined);\r\n    if (!result?.name) return;\r\n\r\n    try {\r\n      // Create folder via API\r\n      const unique = crypto.randomUUID();\r\n\r\n      await NoteswikiService.createFolder({\r\n        body: { unique, name: result.name, parentUnique },\r\n      });\r\n\r\n      // Show success notification\r\n      const notificationContext = await this.getContext(UMB_NOTIFICATION_CONTEXT);\r\n      notificationContext?.peek(\"positive\", {\r\n        data: {\r\n          headline: \"Folder created\",\r\n          message: `Folder \"${result.name}\" has been created.`,\r\n        },\r\n      });\r\n\r\n      // Refresh tree by dispatching reload event\r\n      const eventContext = await this.getContext(UMB_ACTION_EVENT_CONTEXT);\r\n      if (eventContext) {\r\n        eventContext.dispatchEvent(\r\n          new UmbRequestReloadChildrenOfEntityEvent({\r\n            entityType: NOTES_FOLDER_ENTITY_TYPE,\r\n            unique: parentUnique,\r\n          })\r\n        );\r\n      }\r\n\r\n      // Navigate to the new folder's workspace\r\n      const folderPath = UMB_EDIT_FOLDER_WORKSPACE_PATH_PATTERN.generateAbsolute({\r\n        unique,\r\n      });\r\n      history.pushState({}, \"\", folderPath);\r\n    } catch (error) {\r\n      console.error(\"Error creating folder:\", error);\r\n\r\n      const notificationContext = await this.getContext(UMB_NOTIFICATION_CONTEXT);\r\n      notificationContext?.peek(\"danger\", {\r\n        data: {\r\n          headline: \"Error\",\r\n          message: \"Failed to create the folder. Please try again.\",\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  #getFilteredChildren(): ChildItem[] {\r\n    if (!this._searchQuery.trim()) {\r\n      return this._children;\r\n    }\r\n    const query = this._searchQuery.toLowerCase();\r\n    return this._children.filter((item) =>\r\n      item.name.toLowerCase().includes(query)\r\n    );\r\n  }\r\n\r\n  #renderToolbar() {\r\n    return html`\r\n      <div class=\"toolbar\">\r\n        <uui-button\r\n          popovertarget=\"create-menu-popover\"\r\n          label=\"Create\"\r\n          color=\"default\"\r\n          look=\"outline\"\r\n        >\r\n          Create\r\n          <uui-symbol-expand .open=${this._createMenuOpen}></uui-symbol-expand>\r\n        </uui-button>\r\n        <uui-popover-container\r\n          id=\"create-menu-popover\"\r\n          placement=\"bottom-start\"\r\n          @toggle=${this.#onPopoverToggle}\r\n        >\r\n          <umb-popover-layout>\r\n            <uui-scroll-container>\r\n              <uui-menu-item label=\"Note\" href=${this.#getCreateNoteHref()}>\r\n                <umb-icon slot=\"icon\" name=\"icon-notepad\"></umb-icon>\r\n              </uui-menu-item>\r\n              <uui-menu-item label=\"Folder\" @click=${this.#handleCreateFolder}>\r\n                <umb-icon slot=\"icon\" name=\"icon-folder\"></umb-icon>\r\n              </uui-menu-item>\r\n            </uui-scroll-container>\r\n          </umb-popover-layout>\r\n        </uui-popover-container>\r\n        <uui-input\r\n          placeholder=\"Search in folder...\"\r\n          .value=${this._searchQuery}\r\n          @input=${this.#handleSearchInput}\r\n        ></uui-input>\r\n        <span class=\"item-count\">${this.#getFilteredChildren().length} items</span>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  #renderGrid() {\r\n    if (this._loading) {\r\n      return html`\r\n        <div class=\"loading\">\r\n          <uui-loader></uui-loader>\r\n        </div>\r\n      `;\r\n    }\r\n\r\n    const filteredChildren = this.#getFilteredChildren();\r\n\r\n    if (this._children.length === 0) {\r\n      return html`\r\n        <div class=\"empty-state\">\r\n          <uui-icon name=\"icon-folder\"></uui-icon>\r\n          <p>This folder is empty.</p>\r\n          <p>Use the actions menu to create notes or subfolders.</p>\r\n        </div>\r\n      `;\r\n    }\r\n\r\n    if (filteredChildren.length === 0) {\r\n      return html`\r\n        <div class=\"empty-state\">\r\n          <uui-icon name=\"icon-search\"></uui-icon>\r\n          <p>No items match \"${this._searchQuery}\"</p>\r\n        </div>\r\n      `;\r\n    }\r\n\r\n    return html`\r\n      <div class=\"grid\">\r\n        ${filteredChildren.map((item) => html`\r\n          <a class=\"grid-item\" href=${this.#getItemHref(item)}>\r\n            <div class=\"grid-item-icon\">\r\n              <uui-icon name=${item.icon}></uui-icon>\r\n            </div>\r\n            <div class=\"grid-item-name\">${item.name}</div>\r\n          </a>\r\n        `)}\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  override render() {\r\n    return html`\r\n      <umb-workspace-editor alias=\"Notes.Workspace.Folder\">\r\n        <div id=\"header\" slot=\"header\">\r\n          <uui-icon name=\"icon-folder\"></uui-icon>\r\n          <span>${this._name || \"Loading...\"}</span>\r\n        </div>\r\n        <div class=\"content\">\r\n          ${this.#renderToolbar()}\r\n          ${this.#renderGrid()}\r\n        </div>\r\n      </umb-workspace-editor>\r\n    `;\r\n  }\r\n\r\n  static override styles = css`\r\n    :host {\r\n      display: block;\r\n      height: 100%;\r\n    }\r\n\r\n    #header {\r\n      display: flex;\r\n      align-items: center;\r\n      gap: var(--uui-size-space-3);\r\n      font-size: var(--uui-type-h5-size);\r\n      font-weight: 700;\r\n    }\r\n\r\n    .content {\r\n      padding: var(--uui-size-space-5);\r\n      height: 100%;\r\n      box-sizing: border-box;\r\n    }\r\n\r\n    .toolbar {\r\n      display: flex;\r\n      align-items: center;\r\n      gap: var(--uui-size-space-4);\r\n      margin-bottom: var(--uui-size-space-4);\r\n      position: relative;\r\n    }\r\n\r\n    .toolbar uui-input {\r\n      flex: 1;\r\n      max-width: 400px;\r\n    }\r\n\r\n    .item-count {\r\n      color: var(--uui-color-text-alt);\r\n      font-size: var(--uui-type-small-size);\r\n    }\r\n\r\n    .loading {\r\n      display: flex;\r\n      justify-content: center;\r\n      align-items: center;\r\n      padding: var(--uui-size-space-6);\r\n    }\r\n\r\n    .empty-state {\r\n      display: flex;\r\n      flex-direction: column;\r\n      align-items: center;\r\n      justify-content: center;\r\n      padding: var(--uui-size-layout-2);\r\n      color: var(--uui-color-text-alt);\r\n      text-align: center;\r\n    }\r\n\r\n    .empty-state uui-icon {\r\n      font-size: 64px;\r\n      margin-bottom: var(--uui-size-space-4);\r\n      opacity: 0.5;\r\n    }\r\n\r\n    .empty-state p {\r\n      margin: var(--uui-size-space-1) 0;\r\n    }\r\n\r\n    .grid {\r\n      display: grid;\r\n      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));\r\n      grid-auto-rows: min-content;\r\n      gap: var(--uui-size-space-4);\r\n    }\r\n\r\n    .grid-item {\r\n      display: flex;\r\n      flex-direction: column;\r\n      align-items: center;\r\n      padding: var(--uui-size-space-4);\r\n      border: 1px solid var(--uui-color-border);\r\n      border-radius: var(--uui-border-radius);\r\n      background: var(--uui-color-surface);\r\n      text-decoration: none;\r\n      color: var(--uui-color-text);\r\n      transition: all 0.1s ease;\r\n      cursor: pointer;\r\n    }\r\n\r\n    .grid-item:hover {\r\n      border-color: var(--uui-color-border-emphasis);\r\n      background: var(--uui-color-surface-emphasis);\r\n    }\r\n\r\n    .grid-item-icon {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      width: 80px;\r\n      height: 80px;\r\n      margin-bottom: var(--uui-size-space-3);\r\n      background: var(--uui-color-surface-alt);\r\n      border-radius: var(--uui-border-radius);\r\n    }\r\n\r\n    .grid-item-icon uui-icon {\r\n      font-size: 32px;\r\n      color: var(--uui-color-text-alt);\r\n    }\r\n\r\n    .grid-item-name {\r\n      font-size: var(--uui-type-small-size);\r\n      text-align: center;\r\n      word-break: break-word;\r\n      max-width: 100%;\r\n    }\r\n  `;\r\n}\r\n\r\nexport default FolderWorkspaceEditorElement;\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    \"folder-workspace-editor-element\": FolderWorkspaceEditorElement;\r\n  }\r\n}\r\n","/**\r\n * Folder Workspace Context\r\n *\r\n * The workspace context for viewing a folder and its contents.\r\n * This is a read-only workspace - folders are renamed via entity actions.\r\n *\r\n * Skills used: umbraco-workspace, umbraco-context-api, umbraco-state-management\r\n */\r\n\r\nimport { NOTES_FOLDER_WORKSPACE_ALIAS } from \"../constants.js\";\r\nimport { FolderWorkspaceEditorElement } from \"./folder-workspace-editor.element.js\";\r\nimport { UmbSubmittableWorkspaceContextBase } from \"@umbraco-cms/backoffice/workspace\";\r\nimport { UmbStringState } from \"@umbraco-cms/backoffice/observable-api\";\r\nimport type { UmbControllerHost } from \"@umbraco-cms/backoffice/controller-api\";\r\nimport { NOTES_FOLDER_ENTITY_TYPE } from \"../../constants.js\";\r\nimport { NoteswikiService } from \"../../api/index.js\";\r\n\r\n/**\r\n * Model for folder data\r\n */\r\nexport interface FolderWorkspaceData {\r\n  unique: string;\r\n  name: string;\r\n  parentUnique: string | null;\r\n}\r\n\r\n/**\r\n * Workspace context for viewing folders\r\n *\r\n * Extends UmbSubmittableWorkspaceContextBase to get routing support.\r\n * This is a read-only workspace - submit() is a no-op.\r\n */\r\nexport class FolderWorkspaceContext extends UmbSubmittableWorkspaceContextBase<FolderWorkspaceData> {\r\n  // Observable state\r\n  #unique = new UmbStringState(undefined);\r\n  readonly unique = this.#unique.asObservable();\r\n\r\n  #name = new UmbStringState(\"\");\r\n  readonly name = this.#name.asObservable();\r\n\r\n  #parentUnique = new UmbStringState(undefined);\r\n  readonly parentUnique = this.#parentUnique.asObservable();\r\n\r\n  constructor(host: UmbControllerHost) {\r\n    super(host, NOTES_FOLDER_WORKSPACE_ALIAS);\r\n\r\n    // Define workspace routes\r\n    this.routes.setRoutes([\r\n      {\r\n        // View folder contents\r\n        path: \"edit/:unique\",\r\n        component: FolderWorkspaceEditorElement,\r\n        setup: (_component, info) => {\r\n          const unique = info.match.params.unique;\r\n          this.load(unique);\r\n        },\r\n      },\r\n    ]);\r\n  }\r\n\r\n  /**\r\n   * Load folder data from the API\r\n   */\r\n  async load(unique: string) {\r\n    this.#unique.setValue(unique);\r\n\r\n    try {\r\n      const response = await NoteswikiService.getFolder({\r\n        path: { id: unique },\r\n      });\r\n\r\n      const data = response.data;\r\n      this.#name.setValue(data.name);\r\n      this.#parentUnique.setValue(data.parentUnique ?? undefined);\r\n    } catch (error) {\r\n      console.error(\"Error loading folder:\", error);\r\n      this.#name.setValue(\"Error loading folder\");\r\n    }\r\n  }\r\n\r\n  // Getters required by UmbSubmittableWorkspaceContextBase\r\n  getUnique() {\r\n    return this.#unique.getValue();\r\n  }\r\n\r\n  getEntityType() {\r\n    return NOTES_FOLDER_ENTITY_TYPE;\r\n  }\r\n\r\n  getData(): FolderWorkspaceData | undefined {\r\n    const unique = this.#unique.getValue();\r\n    if (!unique) return undefined;\r\n\r\n    return {\r\n      unique,\r\n      name: this.#name.getValue(),\r\n      parentUnique: this.#parentUnique.getValue() || null,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Submit is a no-op for the read-only folder workspace.\r\n   * Folders are renamed via entity actions, not the workspace.\r\n   */\r\n  protected async submit(): Promise<void> {\r\n    // No-op - this is a read-only workspace\r\n  }\r\n\r\n  override destroy() {\r\n    this.#unique.destroy();\r\n    this.#name.destroy();\r\n    this.#parentUnique.destroy();\r\n    super.destroy();\r\n  }\r\n}\r\n\r\nexport { FolderWorkspaceContext as api };\r\n"],"names":["_workspaceContext","_FolderWorkspaceEditorElement_instances","observeContext_fn","loadChildren_fn","getItemHref_fn","handleSearchInput_fn","onPopoverToggle_fn","getCreateNoteHref_fn","handleCreateFolder_fn","getFilteredChildren_fn","renderToolbar_fn","renderGrid_fn","FolderWorkspaceEditorElement","UmbLitElement","__privateAdd","UMB_WORKSPACE_CONTEXT","context","__privateSet","__privateMethod","html","__privateGet","name","unique","parentUnique","response","NoteswikiService","item","error","UMB_EDIT_FOLDER_WORKSPACE_PATH_PATTERN","UMB_EDIT_NOTE_WORKSPACE_PATH_PATTERN","target","event","folderUnique","_a","UMB_CREATE_NOTE_WORKSPACE_PATH_PATTERN","NOTES_FOLDER_ENTITY_TYPE","modalManager","UMB_MODAL_MANAGER_CONTEXT","result","FOLDER_NAME_MODAL","notificationContext","UMB_NOTIFICATION_CONTEXT","eventContext","UMB_ACTION_EVENT_CONTEXT","UmbRequestReloadChildrenOfEntityEvent","folderPath","query","filteredChildren","css","__decorateClass","state","customElement","FolderWorkspaceContext","UmbSubmittableWorkspaceContextBase","host","NOTES_FOLDER_WORKSPACE_ALIAS","_unique","_name","_parentUnique","UmbStringState","_component","info","data"],"mappings":"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"}