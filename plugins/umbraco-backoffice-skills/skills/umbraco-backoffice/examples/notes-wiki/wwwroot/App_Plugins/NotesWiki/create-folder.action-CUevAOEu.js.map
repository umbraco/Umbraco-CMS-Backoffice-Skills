{"version":3,"file":"create-folder.action-CUevAOEu.js","sources":["../../../Client/src/entity-actions/create-folder.action.ts"],"sourcesContent":["/**\r\n * Create Folder Entity Action\r\n *\r\n * Allows creating a new folder from the tree context menu.\r\n * Opens a modal to enter the folder name and creates via API.\r\n * After creation, navigates to the new folder's workspace.\r\n *\r\n * Skills used: umbraco-entity-actions, umbraco-modals, umbraco-notifications, umbraco-routing\r\n */\r\n\r\nimport { UmbEntityActionBase, UmbRequestReloadChildrenOfEntityEvent } from \"@umbraco-cms/backoffice/entity-action\";\r\nimport { UMB_MODAL_MANAGER_CONTEXT } from \"@umbraco-cms/backoffice/modal\";\r\nimport { UMB_NOTIFICATION_CONTEXT } from \"@umbraco-cms/backoffice/notification\";\r\nimport { UMB_ACTION_EVENT_CONTEXT } from \"@umbraco-cms/backoffice/action\";\r\nimport { NoteswikiService } from \"../api/index.js\";\r\nimport { FOLDER_NAME_MODAL } from \"./rename-folder.modal-token.js\";\r\nimport { UMB_EDIT_FOLDER_WORKSPACE_PATH_PATTERN } from \"../workspace/paths.js\";\r\n\r\nexport class CreateFolderEntityAction extends UmbEntityActionBase<never> {\r\n  override async execute() {\r\n    // Open create folder modal\r\n    const modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n    if (!modalManager) return;\r\n\r\n    const modal = modalManager.open(this, FOLDER_NAME_MODAL, {\r\n      data: {\r\n        headline: \"Create Folder\",\r\n        currentName: \"\",\r\n        confirmLabel: \"Create\",\r\n      },\r\n    });\r\n\r\n    const result = await modal.onSubmit().catch(() => undefined);\r\n    if (!result?.name) return;\r\n\r\n    try {\r\n      // Create folder via API\r\n      const parentUnique = this.args.unique ?? null;\r\n      const unique = crypto.randomUUID();\r\n\r\n      await NoteswikiService.createFolder({\r\n        body: { unique, name: result.name, parentUnique },\r\n      });\r\n\r\n      // Show success notification\r\n      const notificationContext = await this.getContext(UMB_NOTIFICATION_CONTEXT);\r\n      notificationContext?.peek(\"positive\", {\r\n        data: {\r\n          headline: \"Folder created\",\r\n          message: `Folder \"${result.name}\" has been created.`,\r\n        },\r\n      });\r\n\r\n      // Refresh tree by dispatching reload event\r\n      const eventContext = await this.getContext(UMB_ACTION_EVENT_CONTEXT);\r\n      if (eventContext) {\r\n        eventContext.dispatchEvent(\r\n          new UmbRequestReloadChildrenOfEntityEvent({\r\n            entityType: this.args.entityType,\r\n            unique: this.args.unique ?? null,\r\n          })\r\n        );\r\n      }\r\n\r\n      // Navigate to the new folder's workspace\r\n      const folderPath = UMB_EDIT_FOLDER_WORKSPACE_PATH_PATTERN.generateAbsolute({\r\n        unique,\r\n      });\r\n      history.pushState({}, \"\", folderPath);\r\n    } catch (error) {\r\n      console.error(\"Error creating folder:\", error);\r\n\r\n      const notificationContext = await this.getContext(UMB_NOTIFICATION_CONTEXT);\r\n      notificationContext?.peek(\"danger\", {\r\n        data: {\r\n          headline: \"Error\",\r\n          message: \"Failed to create the folder. Please try again.\",\r\n        },\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nexport default CreateFolderEntityAction;\r\n"],"names":["CreateFolderEntityAction","UmbEntityActionBase","modalManager","UMB_MODAL_MANAGER_CONTEXT","result","FOLDER_NAME_MODAL","parentUnique","unique","NoteswikiService","notificationContext","UMB_NOTIFICATION_CONTEXT","eventContext","UMB_ACTION_EVENT_CONTEXT","UmbRequestReloadChildrenOfEntityEvent","folderPath","UMB_EDIT_FOLDER_WORKSPACE_PATH_PATTERN","error"],"mappings":";;;;;;;;AAkBO,MAAMA,UAAiCC,EAA2B;AAAA,EACvE,MAAe,UAAU;AAEvB,UAAMC,IAAe,MAAM,KAAK,WAAWC,CAAyB;AACpE,QAAI,CAACD,EAAc;AAUnB,UAAME,IAAS,MARDF,EAAa,KAAK,MAAMG,GAAmB;AAAA,MACvD,MAAM;AAAA,QACJ,UAAU;AAAA,QACV,aAAa;AAAA,QACb,cAAc;AAAA,MAAA;AAAA,IAChB,CACD,EAE0B,WAAW,MAAM,MAAA;AAAA,KAAe;AAC3D,QAAKD,KAAA,QAAAA,EAAQ;AAEb,UAAI;AAEF,cAAME,IAAe,KAAK,KAAK,UAAU,MACnCC,IAAS,OAAO,WAAA;AAEtB,cAAMC,EAAiB,aAAa;AAAA,UAClC,MAAM,EAAE,QAAAD,GAAQ,MAAMH,EAAO,MAAM,cAAAE,EAAA;AAAA,QAAa,CACjD;AAGD,cAAMG,IAAsB,MAAM,KAAK,WAAWC,CAAwB;AAC1E,QAAAD,KAAA,QAAAA,EAAqB,KAAK,YAAY;AAAA,UACpC,MAAM;AAAA,YACJ,UAAU;AAAA,YACV,SAAS,WAAWL,EAAO,IAAI;AAAA,UAAA;AAAA,QACjC;AAIF,cAAMO,IAAe,MAAM,KAAK,WAAWC,CAAwB;AACnE,QAAID,KACFA,EAAa;AAAA,UACX,IAAIE,EAAsC;AAAA,YACxC,YAAY,KAAK,KAAK;AAAA,YACtB,QAAQ,KAAK,KAAK,UAAU;AAAA,UAAA,CAC7B;AAAA,QAAA;AAKL,cAAMC,IAAaC,EAAuC,iBAAiB;AAAA,UACzE,QAAAR;AAAA,QAAA,CACD;AACD,gBAAQ,UAAU,IAAI,IAAIO,CAAU;AAAA,MACtC,SAASE,GAAO;AACd,gBAAQ,MAAM,0BAA0BA,CAAK;AAE7C,cAAMP,IAAsB,MAAM,KAAK,WAAWC,CAAwB;AAC1E,QAAAD,KAAA,QAAAA,EAAqB,KAAK,UAAU;AAAA,UAClC,MAAM;AAAA,YACJ,UAAU;AAAA,YACV,SAAS;AAAA,UAAA;AAAA,QACX;AAAA,MAEJ;AAAA,EACF;AACF;"}