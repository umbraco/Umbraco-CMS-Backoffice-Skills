{"version":3,"file":"delete-folder.action-Bvbt3x7D.js","sources":["../../../Client/src/entity-actions/delete-folder.action.ts"],"sourcesContent":["/**\r\n * Delete Folder Entity Action\r\n *\r\n * Deletes a folder from the tree after confirmation.\r\n * Note: This will fail if the folder contains children (notes or subfolders).\r\n *\r\n * Skills used: umbraco-entity-actions, umbraco-modals, umbraco-notifications\r\n */\r\n\r\nimport { UmbEntityActionBase, UmbRequestReloadStructureForEntityEvent } from \"@umbraco-cms/backoffice/entity-action\";\r\nimport { UMB_CONFIRM_MODAL, UMB_MODAL_MANAGER_CONTEXT } from \"@umbraco-cms/backoffice/modal\";\r\nimport { UMB_NOTIFICATION_CONTEXT } from \"@umbraco-cms/backoffice/notification\";\r\nimport { NoteswikiService } from \"../api/index.js\";\r\nimport { UMB_ACTION_EVENT_CONTEXT } from \"@umbraco-cms/backoffice/action\";\r\n\r\nexport class DeleteFolderEntityAction extends UmbEntityActionBase<never> {\r\n  override async execute() {\r\n    const unique = this.args.unique;\r\n    if (!unique) return;\r\n\r\n    // Get modal manager to show confirmation\r\n    const modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n    if (!modalManager) return;\r\n\r\n    const modal = modalManager.open(this, UMB_CONFIRM_MODAL, {\r\n      data: {\r\n        headline: \"Delete Folder\",\r\n        content:\r\n          \"Are you sure you want to delete this folder? The folder must be empty before it can be deleted.\",\r\n        color: \"danger\",\r\n        confirmLabel: \"Delete\",\r\n      },\r\n    });\r\n\r\n    // onSubmit() resolves when user confirms, rejects when cancelled\r\n    // We use a flag pattern to track if the user confirmed\r\n    let confirmed = false;\r\n    await modal.onSubmit().then(() => {\r\n      confirmed = true;\r\n    }).catch(() => {\r\n      // User cancelled - do nothing\r\n    });\r\n\r\n    if (!confirmed) return;\r\n\r\n    try {\r\n      // Call API to delete\r\n      await NoteswikiService.deleteFolder({\r\n        path: { id: unique },\r\n      });\r\n\r\n      // Show success notification\r\n      const notificationContext = await this.getContext(UMB_NOTIFICATION_CONTEXT);\r\n      notificationContext?.peek(\"positive\", {\r\n        data: {\r\n          headline: \"Folder deleted\",\r\n          message: \"The folder has been deleted successfully.\",\r\n        },\r\n      });\r\n\r\n      // Request tree to reload structure - this tells the parent to reload its children\r\n      const eventContext = await this.getContext(UMB_ACTION_EVENT_CONTEXT);\r\n      if (eventContext) {\r\n        const event = new UmbRequestReloadStructureForEntityEvent({\r\n          entityType: this.args.entityType,\r\n          unique: unique,\r\n        });\r\n        eventContext.dispatchEvent(event);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error deleting folder:\", error);\r\n\r\n      const notificationContext = await this.getContext(UMB_NOTIFICATION_CONTEXT);\r\n      notificationContext?.peek(\"danger\", {\r\n        data: {\r\n          headline: \"Error\",\r\n          message:\r\n            \"Failed to delete the folder. Make sure the folder is empty before deleting.\",\r\n        },\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nexport default DeleteFolderEntityAction;\r\n"],"names":["DeleteFolderEntityAction","UmbEntityActionBase","unique","modalManager","UMB_MODAL_MANAGER_CONTEXT","modal","UMB_CONFIRM_MODAL","confirmed","NoteswikiService","notificationContext","UMB_NOTIFICATION_CONTEXT","eventContext","UMB_ACTION_EVENT_CONTEXT","event","UmbRequestReloadStructureForEntityEvent","error"],"mappings":";;;;;;AAeO,MAAMA,UAAiCC,EAA2B;AAAA,EACvE,MAAe,UAAU;AACvB,UAAMC,IAAS,KAAK,KAAK;AACzB,QAAI,CAACA,EAAQ;AAGb,UAAMC,IAAe,MAAM,KAAK,WAAWC,CAAyB;AACpE,QAAI,CAACD,EAAc;AAEnB,UAAME,IAAQF,EAAa,KAAK,MAAMG,GAAmB;AAAA,MACvD,MAAM;AAAA,QACJ,UAAU;AAAA,QACV,SACE;AAAA,QACF,OAAO;AAAA,QACP,cAAc;AAAA,MAAA;AAAA,IAChB,CACD;AAID,QAAIC,IAAY;AAOhB,QANA,MAAMF,EAAM,WAAW,KAAK,MAAM;AAChC,MAAAE,IAAY;AAAA,IACd,CAAC,EAAE,MAAM,MAAM;AAAA,IAEf,CAAC,GAEG,EAACA;AAEL,UAAI;AAEF,cAAMC,EAAiB,aAAa;AAAA,UAClC,MAAM,EAAE,IAAIN,EAAA;AAAA,QAAO,CACpB;AAGD,cAAMO,IAAsB,MAAM,KAAK,WAAWC,CAAwB;AAC1E,QAAAD,KAAA,QAAAA,EAAqB,KAAK,YAAY;AAAA,UACpC,MAAM;AAAA,YACJ,UAAU;AAAA,YACV,SAAS;AAAA,UAAA;AAAA,QACX;AAIF,cAAME,IAAe,MAAM,KAAK,WAAWC,CAAwB;AACnE,YAAID,GAAc;AAChB,gBAAME,IAAQ,IAAIC,EAAwC;AAAA,YACxD,YAAY,KAAK,KAAK;AAAA,YACtB,QAAAZ;AAAA,UAAA,CACD;AACD,UAAAS,EAAa,cAAcE,CAAK;AAAA,QAClC;AAAA,MACF,SAASE,GAAO;AACd,gBAAQ,MAAM,0BAA0BA,CAAK;AAE7C,cAAMN,IAAsB,MAAM,KAAK,WAAWC,CAAwB;AAC1E,QAAAD,KAAA,QAAAA,EAAqB,KAAK,UAAU;AAAA,UAClC,MAAM;AAAA,YACJ,UAAU;AAAA,YACV,SACE;AAAA,UAAA;AAAA,QACJ;AAAA,MAEJ;AAAA,EACF;AACF;"}