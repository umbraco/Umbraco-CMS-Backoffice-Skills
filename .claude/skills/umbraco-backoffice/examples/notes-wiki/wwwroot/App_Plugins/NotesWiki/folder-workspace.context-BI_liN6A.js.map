{"version":3,"file":"folder-workspace.context-BI_liN6A.js","sources":["../../../Client/src/workspace/folder/folder-workspace.context-token.ts","../../../Client/src/workspace/folder/folder-workspace-editor.element.ts","../../../Client/src/workspace/folder/folder-workspace.context.ts"],"sourcesContent":["/**\r\n * Folder Workspace Context Token\r\n *\r\n * The context token is used for dependency injection.\r\n * Components consume this token to access the workspace context.\r\n *\r\n * CRITICAL: The first argument MUST be \"UmbWorkspaceContext\" so that:\r\n * 1. The workspace alias condition can find it\r\n * 2. WorkspaceViews can be displayed based on their conditions\r\n *\r\n * Skills used: umbraco-context-api\r\n */\r\n\r\nimport { UmbContextToken } from \"@umbraco-cms/backoffice/context-api\";\r\nimport type { UmbWorkspaceContext } from \"@umbraco-cms/backoffice/workspace\";\r\nimport type { FolderWorkspaceContext } from \"./folder-workspace.context.js\";\r\nimport { NOTES_FOLDER_ENTITY_TYPE } from \"../../constants.js\";\r\n\r\nexport const FOLDER_WORKSPACE_CONTEXT = new UmbContextToken<\r\n  UmbWorkspaceContext,\r\n  FolderWorkspaceContext\r\n>(\r\n  \"UmbWorkspaceContext\", // MUST match UMB_WORKSPACE_CONTEXT for conditions to work\r\n  undefined,\r\n  (context): context is FolderWorkspaceContext =>\r\n    context.getEntityType?.() === NOTES_FOLDER_ENTITY_TYPE\r\n);\r\n","/**\r\n * Folder Workspace Editor Element\r\n *\r\n * The main editor component for the Folder workspace.\r\n * Folders are simpler than notes - just name editing.\r\n *\r\n * Skills used: umbraco-workspace, umbraco-umbraco-element, umbraco-context-api\r\n */\r\n\r\nimport { FOLDER_WORKSPACE_CONTEXT } from \"./folder-workspace.context-token.js\";\r\nimport { css, html, customElement, state } from \"@umbraco-cms/backoffice/external/lit\";\r\nimport { UmbLitElement } from \"@umbraco-cms/backoffice/lit-element\";\r\nimport { NOTES_FOLDER_WORKSPACE_ALIAS } from \"../manifest.js\";\r\n\r\n@customElement(\"notes-folder-workspace-editor\")\r\nexport class FolderWorkspaceEditorElement extends UmbLitElement {\r\n  #workspaceContext?: typeof FOLDER_WORKSPACE_CONTEXT.TYPE;\r\n\r\n  @state()\r\n  private _name = \"\";\r\n\r\n  @state()\r\n  private _icon = \"icon-folder\";\r\n\r\n  @state()\r\n  private _isNew = false;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.consumeContext(FOLDER_WORKSPACE_CONTEXT, (instance) => {\r\n      this.#workspaceContext = instance;\r\n      this.#observeData();\r\n    });\r\n  }\r\n\r\n  #observeData() {\r\n    if (!this.#workspaceContext) return;\r\n\r\n    this.observe(this.#workspaceContext.name, (name) => {\r\n      this._name = name || \"\";\r\n    });\r\n\r\n    this.observe(this.#workspaceContext.icon, (icon) => {\r\n      this._icon = icon || \"icon-folder\";\r\n    });\r\n\r\n    this.observe(this.#workspaceContext.isNew, (isNew) => {\r\n      this._isNew = isNew;\r\n    });\r\n  }\r\n\r\n  #handleNameChange(e: InputEvent) {\r\n    const target = e.target as HTMLInputElement;\r\n    this.#workspaceContext?.setName(target.value);\r\n  }\r\n\r\n  override render() {\r\n    const displayName = this._name || (this._isNew ? \"New Folder\" : \"Folder\");\r\n\r\n    return html`\r\n      <umb-workspace-editor alias=${NOTES_FOLDER_WORKSPACE_ALIAS}>\r\n        <div id=\"header\" slot=\"header\">\r\n          <uui-icon name=${this._icon}></uui-icon>\r\n          <span class=\"title\">${displayName}</span>\r\n          ${this._isNew ? html`<uui-tag color=\"positive\">New</uui-tag>` : \"\"}\r\n        </div>\r\n\r\n        <div class=\"content\">\r\n          <uui-box headline=\"Folder Details\">\r\n            <div class=\"form-group\">\r\n              <label for=\"name\">Folder Name</label>\r\n              <uui-input\r\n                id=\"name\"\r\n                placeholder=\"Enter folder name...\"\r\n                .value=${this._name}\r\n                @input=${this.#handleNameChange}\r\n              ></uui-input>\r\n            </div>\r\n          </uui-box>\r\n        </div>\r\n      </umb-workspace-editor>\r\n    `;\r\n  }\r\n\r\n  static override readonly styles = [\r\n    css`\r\n      :host {\r\n        display: block;\r\n        width: 100%;\r\n        height: 100%;\r\n      }\r\n\r\n      #header {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: var(--uui-size-space-3);\r\n        font-size: 1.2rem;\r\n        font-weight: bold;\r\n      }\r\n\r\n      uui-icon {\r\n        font-size: 1.5rem;\r\n      }\r\n\r\n      .title {\r\n        flex: 1;\r\n      }\r\n\r\n      .content {\r\n        padding: var(--uui-size-layout-1);\r\n      }\r\n\r\n      .form-group {\r\n        margin-bottom: var(--uui-size-space-5);\r\n      }\r\n\r\n      label {\r\n        display: block;\r\n        margin-bottom: var(--uui-size-space-2);\r\n        font-weight: 600;\r\n        color: var(--uui-color-text);\r\n      }\r\n\r\n      uui-input {\r\n        width: 100%;\r\n        max-width: 400px;\r\n      }\r\n    `,\r\n  ];\r\n}\r\n\r\nexport default FolderWorkspaceEditorElement;\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    \"notes-folder-workspace-editor\": FolderWorkspaceEditorElement;\r\n  }\r\n}\r\n","/**\r\n * Folder Workspace Context\r\n *\r\n * The workspace context manages the state and operations for editing a folder.\r\n * Folders are simpler than notes - they only have a name.\r\n *\r\n * Skills used: umbraco-workspace, umbraco-context-api, umbraco-state-management\r\n */\r\n\r\nimport { FOLDER_WORKSPACE_CONTEXT } from \"./folder-workspace.context-token.js\";\r\nimport { NOTES_FOLDER_WORKSPACE_ALIAS } from \"../manifest.js\";\r\nimport { FolderWorkspaceEditorElement } from \"./folder-workspace-editor.element.js\";\r\nimport { UmbWorkspaceRouteManager } from \"@umbraco-cms/backoffice/workspace\";\r\nimport { UmbStringState, UmbBooleanState } from \"@umbraco-cms/backoffice/observable-api\";\r\nimport type { UmbControllerHost } from \"@umbraco-cms/backoffice/controller-api\";\r\nimport { UmbContextBase } from \"@umbraco-cms/backoffice/class-api\";\r\nimport { NOTES_FOLDER_ENTITY_TYPE } from \"../../constants.js\";\r\nimport { NoteswikiService } from \"../../api/index.js\";\r\n\r\n/**\r\n * Workspace context for editing folders\r\n */\r\nexport class FolderWorkspaceContext extends UmbContextBase {\r\n  public readonly workspaceAlias = NOTES_FOLDER_WORKSPACE_ALIAS;\r\n\r\n  // Observable state\r\n  #unique = new UmbStringState(undefined);\r\n  readonly unique = this.#unique.asObservable();\r\n\r\n  #name = new UmbStringState(\"\");\r\n  readonly name = this.#name.asObservable();\r\n\r\n  #icon = new UmbStringState(\"icon-folder\");\r\n  readonly icon = this.#icon.asObservable();\r\n\r\n  #isNew = new UmbBooleanState(false);\r\n  readonly isNew = this.#isNew.asObservable();\r\n\r\n  #parentUnique = new UmbStringState(undefined);\r\n  readonly parentUnique = this.#parentUnique.asObservable();\r\n\r\n  // Route manager for workspace navigation\r\n  readonly routes = new UmbWorkspaceRouteManager(this);\r\n\r\n  constructor(host: UmbControllerHost) {\r\n    super(host, FOLDER_WORKSPACE_CONTEXT);\r\n\r\n    // Define workspace routes\r\n    this.routes.setRoutes([\r\n      {\r\n        // Edit existing folder\r\n        path: \"edit/:unique\",\r\n        component: FolderWorkspaceEditorElement,\r\n        setup: (_component, info) => {\r\n          const unique = info.match.params.unique;\r\n          this.load(unique);\r\n        },\r\n      },\r\n      {\r\n        // Create new folder\r\n        path: \"create/parent/:parentEntityType/:parentUnique\",\r\n        component: FolderWorkspaceEditorElement,\r\n        setup: (_component, info) => {\r\n          const parentUnique =\r\n            info.match.params.parentUnique === \"null\"\r\n              ? null\r\n              : info.match.params.parentUnique;\r\n          this.createScaffold(parentUnique);\r\n        },\r\n      },\r\n    ]);\r\n  }\r\n\r\n  /**\r\n   * Load an existing folder from the API\r\n   */\r\n  async load(unique: string) {\r\n    this.#unique.setValue(unique);\r\n    this.#isNew.setValue(false);\r\n\r\n    try {\r\n      const response = await NoteswikiService.getFolder({\r\n        path: { id: unique },\r\n      });\r\n\r\n      const data = response.data;\r\n      this.#name.setValue(data.name);\r\n      this.#parentUnique.setValue(data.parentUnique ?? undefined);\r\n    } catch (error) {\r\n      console.error(\"Error loading folder:\", error);\r\n      this.#name.setValue(\"Error loading folder\");\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a scaffold for a new folder\r\n   */\r\n  createScaffold(parentUnique: string | null) {\r\n    const newUnique = crypto.randomUUID();\r\n    this.#unique.setValue(newUnique);\r\n    this.#isNew.setValue(true);\r\n    this.#parentUnique.setValue(parentUnique ?? undefined);\r\n    this.#name.setValue(\"\");\r\n  }\r\n\r\n  /**\r\n   * Save the folder to the API\r\n   */\r\n  async save(): Promise<boolean> {\r\n    const unique = this.#unique.getValue();\r\n    const isNew = this.#isNew.getValue();\r\n\r\n    if (!unique) return false;\r\n\r\n    try {\r\n      if (isNew) {\r\n        await NoteswikiService.createFolder({\r\n          body: {\r\n            unique,\r\n            parentUnique: this.#parentUnique.getValue() || null,\r\n            name: this.#name.getValue(),\r\n          },\r\n        });\r\n      } else {\r\n        await NoteswikiService.updateFolder({\r\n          path: { id: unique },\r\n          body: {\r\n            name: this.#name.getValue(),\r\n          },\r\n        });\r\n      }\r\n\r\n      this.#isNew.setValue(false);\r\n      return true;\r\n    } catch (error) {\r\n      console.error(\"Error saving folder:\", error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Getters\r\n  getUnique() {\r\n    return this.#unique.getValue();\r\n  }\r\n\r\n  getEntityType() {\r\n    return NOTES_FOLDER_ENTITY_TYPE;\r\n  }\r\n\r\n  // Setters for editing\r\n  setName(name: string) {\r\n    this.#name.setValue(name);\r\n  }\r\n\r\n  override destroy() {\r\n    this.#unique.destroy();\r\n    this.#name.destroy();\r\n    this.#icon.destroy();\r\n    this.#isNew.destroy();\r\n    this.#parentUnique.destroy();\r\n    super.destroy();\r\n  }\r\n}\r\n\r\nexport { FolderWorkspaceContext as api };\r\n"],"names":["FOLDER_WORKSPACE_CONTEXT","UmbContextToken","context","_a","NOTES_FOLDER_ENTITY_TYPE","_workspaceContext","_FolderWorkspaceEditorElement_instances","observeData_fn","handleNameChange_fn","FolderWorkspaceEditorElement","UmbLitElement","__privateAdd","instance","__privateSet","__privateMethod","displayName","html","NOTES_FOLDER_WORKSPACE_ALIAS","__privateGet","name","icon","isNew","target","css","__decorateClass","state","customElement","FolderWorkspaceContext","UmbContextBase","host","_unique","_name","_icon","_isNew","_parentUnique","UmbStringState","UmbBooleanState","UmbWorkspaceRouteManager","_component","info","unique","parentUnique","data","NoteswikiService","error","newUnique"],"mappings":"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"}