{"version":3,"file":"note-workspace.context-DJIWmnIf.js","sources":["../../../Client/src/workspace/note/note-workspace-editor.element.ts","../../../Client/src/workspace/note/note-workspace.context.ts"],"sourcesContent":["/**\r\n * Note Workspace Editor Element\r\n *\r\n * The main editor component for the Note workspace.\r\n * Contains the workspace chrome (header, footer) and renders workspace views.\r\n *\r\n * Skills used: umbraco-workspace, umbraco-umbraco-element, umbraco-context-api\r\n */\r\n\r\nimport { NOTE_WORKSPACE_CONTEXT } from \"./note-workspace.context-token.js\";\r\nimport { css, html, customElement, state } from \"@umbraco-cms/backoffice/external/lit\";\r\nimport { UmbLitElement } from \"@umbraco-cms/backoffice/lit-element\";\r\nimport { NOTES_NOTE_WORKSPACE_ALIAS } from \"../manifest.js\";\r\n\r\n@customElement(\"notes-note-workspace-editor\")\r\nexport class NoteWorkspaceEditorElement extends UmbLitElement {\r\n  #workspaceContext?: typeof NOTE_WORKSPACE_CONTEXT.TYPE;\r\n\r\n  @state()\r\n  private _title = \"\";\r\n\r\n  @state()\r\n  private _icon = \"icon-notepad\";\r\n\r\n  @state()\r\n  private _isNew = false;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.consumeContext(NOTE_WORKSPACE_CONTEXT, (instance) => {\r\n      this.#workspaceContext = instance;\r\n      this.#observeData();\r\n    });\r\n  }\r\n\r\n  #observeData() {\r\n    if (!this.#workspaceContext) return;\r\n\r\n    this.observe(this.#workspaceContext.title, (title) => {\r\n      this._title = title || \"\";\r\n    });\r\n\r\n    this.observe(this.#workspaceContext.icon, (icon) => {\r\n      this._icon = icon || \"icon-notepad\";\r\n    });\r\n\r\n    this.observe(this.#workspaceContext.isNew, (isNew) => {\r\n      this._isNew = isNew;\r\n    });\r\n  }\r\n\r\n  override render() {\r\n    const displayTitle = this._title || (this._isNew ? \"New Note\" : \"Note\");\r\n\r\n    return html`\r\n      <umb-workspace-editor alias=${NOTES_NOTE_WORKSPACE_ALIAS}>\r\n        <div id=\"header\" slot=\"header\">\r\n          <uui-icon name=${this._icon}></uui-icon>\r\n          <span class=\"title\">${displayTitle}</span>\r\n          ${this._isNew ? html`<uui-tag color=\"positive\">New</uui-tag>` : \"\"}\r\n        </div>\r\n      </umb-workspace-editor>\r\n    `;\r\n  }\r\n\r\n  static override readonly styles = [\r\n    css`\r\n      :host {\r\n        display: block;\r\n        width: 100%;\r\n        height: 100%;\r\n      }\r\n\r\n      #header {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: var(--uui-size-space-3);\r\n        font-size: 1.2rem;\r\n        font-weight: bold;\r\n      }\r\n\r\n      uui-icon {\r\n        font-size: 1.5rem;\r\n      }\r\n\r\n      .title {\r\n        flex: 1;\r\n      }\r\n    `,\r\n  ];\r\n}\r\n\r\nexport default NoteWorkspaceEditorElement;\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    \"notes-note-workspace-editor\": NoteWorkspaceEditorElement;\r\n  }\r\n}\r\n","/**\r\n * Note Workspace Context\r\n *\r\n * The workspace context manages the state and operations for editing a note.\r\n * It provides observable state for reactive UI updates.\r\n *\r\n * Skills used: umbraco-workspace, umbraco-context-api, umbraco-state-management\r\n *\r\n * Key responsibilities:\r\n * - Load note data from API\r\n * - Track changes (dirty state)\r\n * - Save note to API\r\n * - Provide observable properties for UI binding\r\n */\r\n\r\nimport { NOTE_WORKSPACE_CONTEXT } from \"./note-workspace.context-token.js\";\r\nimport { NOTES_NOTE_WORKSPACE_ALIAS } from \"../manifest.js\";\r\nimport { NoteWorkspaceEditorElement } from \"./note-workspace-editor.element.js\";\r\nimport { UmbWorkspaceRouteManager } from \"@umbraco-cms/backoffice/workspace\";\r\nimport { UmbStringState, UmbArrayState, UmbBooleanState } from \"@umbraco-cms/backoffice/observable-api\";\r\nimport type { UmbControllerHost } from \"@umbraco-cms/backoffice/controller-api\";\r\nimport { UmbContextBase } from \"@umbraco-cms/backoffice/class-api\";\r\nimport { NOTES_NOTE_ENTITY_TYPE } from \"../../constants.js\";\r\nimport { NoteswikiService } from \"../../api/index.js\";\r\n\r\n/**\r\n * Workspace context for editing notes\r\n */\r\nexport class NoteWorkspaceContext extends UmbContextBase {\r\n  public readonly workspaceAlias = NOTES_NOTE_WORKSPACE_ALIAS;\r\n\r\n  // Observable state\r\n  #unique = new UmbStringState(undefined);\r\n  readonly unique = this.#unique.asObservable();\r\n\r\n  #title = new UmbStringState(\"\");\r\n  readonly title = this.#title.asObservable();\r\n\r\n  #content = new UmbStringState(\"\");\r\n  readonly content = this.#content.asObservable();\r\n\r\n  #tags = new UmbArrayState<string>([], (x) => x);\r\n  readonly tags = this.#tags.asObservable();\r\n\r\n  #icon = new UmbStringState(\"icon-notepad\");\r\n  readonly icon = this.#icon.asObservable();\r\n\r\n  #isNew = new UmbBooleanState(false);\r\n  readonly isNew = this.#isNew.asObservable();\r\n\r\n  #parentUnique = new UmbStringState(undefined);\r\n  readonly parentUnique = this.#parentUnique.asObservable();\r\n\r\n  // Route manager for workspace navigation\r\n  readonly routes = new UmbWorkspaceRouteManager(this);\r\n\r\n  constructor(host: UmbControllerHost) {\r\n    super(host, NOTE_WORKSPACE_CONTEXT);\r\n\r\n    // Define workspace routes\r\n    this.routes.setRoutes([\r\n      {\r\n        // Edit existing note\r\n        path: \"edit/:unique\",\r\n        component: NoteWorkspaceEditorElement,\r\n        setup: (_component, info) => {\r\n          const unique = info.match.params.unique;\r\n          this.load(unique);\r\n        },\r\n      },\r\n      {\r\n        // Create new note\r\n        path: \"create/parent/:parentEntityType/:parentUnique\",\r\n        component: NoteWorkspaceEditorElement,\r\n        setup: (_component, info) => {\r\n          const parentUnique =\r\n            info.match.params.parentUnique === \"null\"\r\n              ? null\r\n              : info.match.params.parentUnique;\r\n          this.createScaffold(parentUnique);\r\n        },\r\n      },\r\n    ]);\r\n  }\r\n\r\n  /**\r\n   * Load an existing note from the API\r\n   */\r\n  async load(unique: string) {\r\n    this.#unique.setValue(unique);\r\n    this.#isNew.setValue(false);\r\n\r\n    try {\r\n      const response = await NoteswikiService.getNote({\r\n        path: { id: unique },\r\n      });\r\n\r\n      const data = response.data;\r\n      this.#title.setValue(data.title);\r\n      this.#content.setValue(data.content);\r\n      this.#tags.setValue(data.tags || []);\r\n      this.#parentUnique.setValue(data.parentUnique ?? undefined);\r\n    } catch (error) {\r\n      console.error(\"Error loading note:\", error);\r\n      // Set default values on error\r\n      this.#title.setValue(\"Error loading note\");\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a scaffold for a new note\r\n   */\r\n  createScaffold(parentUnique: string | null) {\r\n    const newUnique = crypto.randomUUID();\r\n    this.#unique.setValue(newUnique);\r\n    this.#isNew.setValue(true);\r\n    this.#parentUnique.setValue(parentUnique ?? undefined);\r\n    this.#title.setValue(\"\");\r\n    this.#content.setValue(\"\");\r\n    this.#tags.setValue([]);\r\n  }\r\n\r\n  /**\r\n   * Save the note to the API\r\n   */\r\n  async save(): Promise<boolean> {\r\n    const unique = this.#unique.getValue();\r\n    const isNew = this.#isNew.getValue();\r\n\r\n    if (!unique) return false;\r\n\r\n    try {\r\n      if (isNew) {\r\n        await NoteswikiService.createNote({\r\n          body: {\r\n            unique,\r\n            parentUnique: this.#parentUnique.getValue() || null,\r\n            title: this.#title.getValue(),\r\n            content: this.#content.getValue(),\r\n            tags: this.#tags.getValue(),\r\n          },\r\n        });\r\n      } else {\r\n        await NoteswikiService.updateNote({\r\n          path: { id: unique },\r\n          body: {\r\n            title: this.#title.getValue(),\r\n            content: this.#content.getValue(),\r\n            tags: this.#tags.getValue(),\r\n          },\r\n        });\r\n      }\r\n\r\n      this.#isNew.setValue(false);\r\n      return true;\r\n    } catch (error) {\r\n      console.error(\"Error saving note:\", error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Getters\r\n  getUnique() {\r\n    return this.#unique.getValue();\r\n  }\r\n\r\n  getEntityType() {\r\n    return NOTES_NOTE_ENTITY_TYPE;\r\n  }\r\n\r\n  // Setters for editing\r\n  setTitle(title: string) {\r\n    this.#title.setValue(title);\r\n  }\r\n\r\n  setContent(content: string) {\r\n    this.#content.setValue(content);\r\n  }\r\n\r\n  setTags(tags: string[]) {\r\n    this.#tags.setValue(tags);\r\n  }\r\n\r\n  addTag(tag: string) {\r\n    const currentTags = this.#tags.getValue();\r\n    if (!currentTags.includes(tag)) {\r\n      this.#tags.setValue([...currentTags, tag]);\r\n    }\r\n  }\r\n\r\n  removeTag(tag: string) {\r\n    const currentTags = this.#tags.getValue();\r\n    this.#tags.setValue(currentTags.filter((t) => t !== tag));\r\n  }\r\n\r\n  override destroy() {\r\n    this.#unique.destroy();\r\n    this.#title.destroy();\r\n    this.#content.destroy();\r\n    this.#tags.destroy();\r\n    this.#icon.destroy();\r\n    this.#isNew.destroy();\r\n    this.#parentUnique.destroy();\r\n    super.destroy();\r\n  }\r\n}\r\n\r\nexport { NoteWorkspaceContext as api };\r\n"],"names":["_workspaceContext","_NoteWorkspaceEditorElement_instances","observeData_fn","NoteWorkspaceEditorElement","UmbLitElement","__privateAdd","NOTE_WORKSPACE_CONTEXT","instance","__privateSet","__privateMethod","displayTitle","html","NOTES_NOTE_WORKSPACE_ALIAS","__privateGet","title","icon","isNew","css","__decorateClass","state","customElement","NoteWorkspaceContext","UmbContextBase","host","_unique","_title","_content","_tags","_icon","_isNew","_parentUnique","UmbStringState","UmbArrayState","x","UmbBooleanState","UmbWorkspaceRouteManager","_component","info","unique","parentUnique","data","NoteswikiService","error","newUnique","NOTES_NOTE_ENTITY_TYPE","content","tags","tag","currentTags","t"],"mappings":"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"}