{"version":3,"file":"notes-tree.repository-nnfyCMF_.js","sources":["../../../Client/src/tree/notes-tree.server.data-source.ts","../../../Client/src/tree/notes-tree.repository.ts"],"sourcesContent":["/**\r\n * Notes Tree Server Data Source\r\n *\r\n * Fetches tree data from the C# backend API using the generated OpenAPI client.\r\n * Extends Umbraco's UmbTreeServerDataSourceBase for consistent patterns.\r\n *\r\n * Skills used: umbraco-repository-pattern, umbraco-tree\r\n *\r\n * The data source:\r\n * - Fetches root items, children, and ancestors from API\r\n * - Maps API responses to tree item models\r\n * - Handles pagination (skip/take)\r\n *\r\n * IMPORTANT: Uses the generated OpenAPI client which handles authentication\r\n * via bearer tokens automatically.\r\n */\r\n\r\nimport type { UmbControllerHost } from \"@umbraco-cms/backoffice/controller-api\";\r\nimport type {\r\n  UmbTreeAncestorsOfRequestArgs,\r\n  UmbTreeChildrenOfRequestArgs,\r\n  UmbTreeRootItemsRequestArgs,\r\n} from \"@umbraco-cms/backoffice/tree\";\r\nimport { UmbTreeServerDataSourceBase } from \"@umbraco-cms/backoffice/tree\";\r\nimport {\r\n  NOTES_ROOT_ENTITY_TYPE,\r\n  NOTES_FOLDER_ENTITY_TYPE,\r\n  NOTES_NOTE_ENTITY_TYPE,\r\n} from \"../constants.js\";\r\nimport type { NotesTreeItemModel } from \"./types.js\";\r\nimport type { TreeItemModel } from \"../api/index.js\";\r\nimport { NoteswikiService } from \"../api/index.js\";\r\n\r\n/**\r\n * Data source for fetching Notes tree data from the server\r\n */\r\nexport class NotesTreeServerDataSource extends UmbTreeServerDataSourceBase<\r\n  TreeItemModel,\r\n  NotesTreeItemModel\r\n> {\r\n  constructor(host: UmbControllerHost) {\r\n    super(host, {\r\n      getRootItems,\r\n      getChildrenOf,\r\n      getAncestorsOf,\r\n      mapper,\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Fetch root tree items\r\n */\r\nconst getRootItems = async (args: UmbTreeRootItemsRequestArgs) => {\r\n  const response = await NoteswikiService.getRoot({\r\n    query: { skip: args.skip, take: args.take },\r\n  });\r\n\r\n  // Return paged model format expected by UmbTreeServerDataSourceBase\r\n  return {\r\n    data: {\r\n      items: response.data.items,\r\n      total: response.data.total,\r\n    },\r\n  };\r\n};\r\n\r\n/**\r\n * Fetch children of a tree item\r\n */\r\nconst getChildrenOf = async (args: UmbTreeChildrenOfRequestArgs) => {\r\n  if (args.parent?.unique === null) {\r\n    return await getRootItems(args);\r\n  }\r\n\r\n  const response = await NoteswikiService.getChildren({\r\n    path: { parentId: args.parent.unique },\r\n    query: { skip: args.skip, take: args.take },\r\n  });\r\n\r\n  return {\r\n    data: {\r\n      items: response.data.items,\r\n      total: response.data.total,\r\n    },\r\n  };\r\n};\r\n\r\n/**\r\n * Fetch ancestors of a tree item (for breadcrumb/path)\r\n */\r\nconst getAncestorsOf = async (args: UmbTreeAncestorsOfRequestArgs) => {\r\n  const response = await NoteswikiService.getAncestors({\r\n    path: { id: args.treeItem.unique },\r\n  });\r\n\r\n  return { data: response.data };\r\n};\r\n\r\n/**\r\n * Map API response to tree item model\r\n *\r\n * CRITICAL: entityType determines which workspace opens when item is clicked\r\n */\r\nconst mapper = (item: TreeItemModel): NotesTreeItemModel => {\r\n  // Determine entity type based on API response\r\n  let entityType: typeof NOTES_FOLDER_ENTITY_TYPE | typeof NOTES_NOTE_ENTITY_TYPE;\r\n\r\n  if (item.isFolder || item.entityType === \"notes-folder\") {\r\n    entityType = NOTES_FOLDER_ENTITY_TYPE;\r\n  } else {\r\n    entityType = NOTES_NOTE_ENTITY_TYPE;\r\n  }\r\n\r\n  return {\r\n    unique: item.id,\r\n    parent: {\r\n      unique: item.parentId || null,\r\n      entityType: item.parentId ? NOTES_FOLDER_ENTITY_TYPE : NOTES_ROOT_ENTITY_TYPE,\r\n    },\r\n    name: item.name,\r\n    entityType: entityType,\r\n    hasChildren: item.hasChildren,\r\n    isFolder: item.isFolder,\r\n    icon: item.icon || (item.isFolder ? \"icon-folder\" : \"icon-notepad\"),\r\n  };\r\n};\r\n","/**\r\n * Notes Tree Repository\r\n *\r\n * The repository is the main interface for tree data operations.\r\n * It coordinates between the data source (API) and the store (cache).\r\n *\r\n * Skills used: umbraco-repository-pattern, umbraco-tree\r\n *\r\n * The repository:\r\n * - Extends UmbTreeRepositoryBase for standard tree operations\r\n * - Provides the tree root model\r\n * - Is registered via manifest and referenced by the tree\r\n */\r\n\r\nimport type { UmbControllerHost } from \"@umbraco-cms/backoffice/controller-api\";\r\nimport type { UmbApi } from \"@umbraco-cms/backoffice/extension-api\";\r\nimport { UmbTreeRepositoryBase } from \"@umbraco-cms/backoffice/tree\";\r\nimport { NotesTreeServerDataSource } from \"./notes-tree.server.data-source.js\";\r\nimport { NOTES_TREE_STORE_CONTEXT } from \"./notes-tree.store.js\";\r\nimport {\r\n  NOTES_ROOT_ENTITY_TYPE,\r\n} from \"../constants.js\";\r\nimport type { NotesTreeItemModel, NotesTreeRootModel } from \"./types.js\";\r\n\r\n/**\r\n * Repository for Notes tree operations\r\n */\r\nexport class NotesTreeRepository\r\n  extends UmbTreeRepositoryBase<NotesTreeItemModel, NotesTreeRootModel>\r\n  implements UmbApi\r\n{\r\n  constructor(host: UmbControllerHost) {\r\n    super(host, NotesTreeServerDataSource, NOTES_TREE_STORE_CONTEXT);\r\n  }\r\n\r\n  /**\r\n   * Returns the root model for the tree.\r\n   * This is displayed when hideTreeRoot is false.\r\n   */\r\n  async requestTreeRoot() {\r\n    const data: NotesTreeRootModel = {\r\n      unique: null,\r\n      entityType: NOTES_ROOT_ENTITY_TYPE,\r\n      name: \"Notes\",\r\n      icon: \"icon-notepad\",\r\n      hasChildren: true,\r\n      isFolder: true,\r\n    };\r\n\r\n    return { data };\r\n  }\r\n}\r\n\r\nexport { NotesTreeRepository as api };\r\n"],"names":["NotesTreeServerDataSource","UmbTreeServerDataSourceBase","host","getRootItems","getChildrenOf","getAncestorsOf","mapper","args","response","NoteswikiService","_a","item","entityType","NOTES_FOLDER_ENTITY_TYPE","NOTES_NOTE_ENTITY_TYPE","NOTES_ROOT_ENTITY_TYPE","NotesTreeRepository","UmbTreeRepositoryBase","NOTES_TREE_STORE_CONTEXT"],"mappings":";;;;;AAoCO,MAAMA,UAAkCC,EAG7C;AAAA,EACA,YAAYC,GAAyB;AACnC,UAAMA,GAAM;AAAA,MACV,cAAAC;AAAA,MACA,eAAAC;AAAA,MACA,gBAAAC;AAAA,MACA,QAAAC;AAAA,IAAA,CACD;AAAA,EACH;AACF;AAKA,MAAMH,IAAe,OAAOI,MAAsC;AAChE,QAAMC,IAAW,MAAMC,EAAiB,QAAQ;AAAA,IAC9C,OAAO,EAAE,MAAMF,EAAK,MAAM,MAAMA,EAAK,KAAA;AAAA,EAAK,CAC3C;AAGD,SAAO;AAAA,IACL,MAAM;AAAA,MACJ,OAAOC,EAAS,KAAK;AAAA,MACrB,OAAOA,EAAS,KAAK;AAAA,IAAA;AAAA,EACvB;AAEJ,GAKMJ,IAAgB,OAAOG,MAAuC;;AAClE,QAAIG,IAAAH,EAAK,WAAL,gBAAAG,EAAa,YAAW;AAC1B,WAAO,MAAMP,EAAaI,CAAI;AAGhC,QAAMC,IAAW,MAAMC,EAAiB,YAAY;AAAA,IAClD,MAAM,EAAE,UAAUF,EAAK,OAAO,OAAA;AAAA,IAC9B,OAAO,EAAE,MAAMA,EAAK,MAAM,MAAMA,EAAK,KAAA;AAAA,EAAK,CAC3C;AAED,SAAO;AAAA,IACL,MAAM;AAAA,MACJ,OAAOC,EAAS,KAAK;AAAA,MACrB,OAAOA,EAAS,KAAK;AAAA,IAAA;AAAA,EACvB;AAEJ,GAKMH,IAAiB,OAAOE,OAKrB,EAAE,OAJQ,MAAME,EAAiB,aAAa;AAAA,EACnD,MAAM,EAAE,IAAIF,EAAK,SAAS,OAAA;AAAO,CAClC,GAEuB,KAAA,IAQpBD,IAAS,CAACK,MAA4C;AAE1D,MAAIC;AAEJ,SAAID,EAAK,YAAYA,EAAK,eAAe,iBACvCC,IAAaC,IAEbD,IAAaE,GAGR;AAAA,IACL,QAAQH,EAAK;AAAA,IACb,QAAQ;AAAA,MACN,QAAQA,EAAK,YAAY;AAAA,MACzB,YAAYA,EAAK,WAAWE,IAA2BE;AAAA,IAAA;AAAA,IAEzD,MAAMJ,EAAK;AAAA,IACX,YAAAC;AAAA,IACA,aAAaD,EAAK;AAAA,IAClB,UAAUA,EAAK;AAAA,IACf,MAAMA,EAAK,SAASA,EAAK,WAAW,gBAAgB;AAAA,EAAA;AAExD;ACnGO,MAAMK,UACHC,EAEV;AAAA,EACE,YAAYf,GAAyB;AACnC,UAAMA,GAAMF,GAA2BkB,CAAwB;AAAA,EACjE;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,kBAAkB;AAUtB,WAAO,EAAE,MATwB;AAAA,MAC/B,QAAQ;AAAA,MACR,YAAYH;AAAA,MACZ,MAAM;AAAA,MACN,MAAM;AAAA,MACN,aAAa;AAAA,MACb,UAAU;AAAA,IAAA,EAGH;AAAA,EACX;AACF;"}